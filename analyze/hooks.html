<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hooks æ—¥å¿—åˆ†æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* æ–‡ä»¶ä¸Šä¼ ç»„ä»¶æ ·å¼ */
        .upload-section {
            margin-bottom: 30px;
        }

        .upload-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px dashed #cbd5e0;
            transition: all 0.3s ease;
        }

        .upload-card:hover {
            border-color: #667eea;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .upload-header {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 20px;
            text-align: center;
        }

        .upload-area {
            border: 2px dashed #e2e8f0;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: #edf2f7;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.7;
        }

        .upload-text {
            font-size: 1.1rem;
            color: #4a5568;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .upload-hint {
            font-size: 0.9rem;
            color: #718096;
            margin-bottom: 20px;
        }

        .upload-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .file-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f7fafc;
            padding: 15px 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .file-name {
            font-weight: 500;
            color: #4a5568;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .clear-btn {
            background: #fc8181;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            background: #f56565;
            transform: scale(1.1);
        }

        /* æ¶ˆæ¯æç¤ºæ ·å¼ */
        .upload-message {
            margin-top: 15px;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            animation: slideIn 0.3s ease;
        }

        .upload-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .upload-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #file-input {
            display: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-description {
            font-size: 0.9rem;
            color: #999;
        }

        .filter-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .filter-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-label {
            font-weight: bold;
            color: #333;
        }

        .filter-select, .search-input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus, .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-input {
            min-width: 200px;
        }

        .hooks-container {
            display: grid;
            gap: 30px;
        }

        .hook-item {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .hook-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .hook-event {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .hook-meta {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .hook-timestamp {
            font-size: 0.9rem;
            color: #666;
            background: #f0f4ff;
            padding: 5px 12px;
            border-radius: 20px;
        }

        .hook-message {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .hook-description {
            color: #666;
            font-style: italic;
            margin-bottom: 15px;
        }

        .hook-details {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .part-card {
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
        }

        .part-header {
            background: #667eea;
            color: white;
            padding: 12px 15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .part-header:hover {
            background: #5a67d8;
        }

        .part-content {
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            background: #1a1a1a;
            color: #ffffff;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.6;
            min-height: 100px;
            border-radius: 8px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .part-content.hidden {
            display: none;
        }

        .toggle-icon {
            transition: transform 0.3s ease;
        }

        .toggle-icon.rotated {
            transform: rotate(180deg);
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .part-content::-webkit-scrollbar {
            width: 8px;
        }

        .part-content::-webkit-scrollbar-track {
            background: #2a2a2a;
            border-radius: 4px;
        }

        .part-content::-webkit-scrollbar-thumb {
            background: #4a4a4a;
            border-radius: 4px;
        }

        .part-content::-webkit-scrollbar-thumb:hover {
            background: #5a5a5a;
        }

        .event-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 10px;
        }

        .event-userprompt { background: #FF6B6B; color: white; }
        .event-pretool { background: #4ECDC4; color: white; }
        .event-posttool { background: #45B7D1; color: white; }
        .event-notification { background: #9C27B0; color: white; }
        .event-stop { background: #F44336; color: white; }
        .event-subagent-stop { background: #FF9800; color: white; }
        .event-pre-compact { background: #FFC107; color: white; }
        .event-session-start { background: #4CAF50; color: white; }
        .event-session-end { background: #607D8B; color: white; }
        .event-default { background: #78909C; color: white; }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: white;
            font-size: 1.2rem;
        }

        .error-message {
            background: #fff5f5;
            border: 2px solid #fc8181;
            color: #c53030;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.1rem;
            margin: 20px 0;
        }

        .json-key { color: #9C27B0; }
        .json-string { color: #4CAF50; }
        .json-number { color: #FF9800; }
        .json-boolean { color: #F44336; }
        .json-null { color: #9E9E9E; }
        .json-url { color: #2196F3; text-decoration: underline; cursor: pointer; }

        .transcript-path {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 8px 12px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .transcript-path-label {
            font-weight: bold;
            color: #856404;
            margin-bottom: 5px;
        }

        .transcript-path-value {
            color: #856404;
            word-break: break-all;
            font-family: monospace;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 3px;
        }

        .has-transcript-badge {
            background: #ffc107;
            color: #212529;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .transcript-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .transcript-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .transcript-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .transcript-btn.copy {
            background: #28a745;
        }

        .transcript-btn.copy:hover {
            background: #218838;
        }

        .transcript-btn.open {
            background: #007bff;
        }

        .transcript-btn.open:hover {
            background: #0056b3;
        }

        .transcript-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .search-input {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Hooks æ—¥å¿—åˆ†æ</h1>
            <p>ä¸Šä¼ å¹¶åˆ†æ Claude Hooks äº‹ä»¶æ—¥å¿—</p>
        </div>

        <!-- æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ -->
        <div class="upload-section">
            <div class="upload-card">
                <div class="upload-header">
                    <span>ğŸ“ é€‰æ‹© Hooks æ—¥å¿—æ–‡ä»¶</span>
                </div>
                <div class="upload-area" id="upload-area">
                    <div class="upload-content">
                        <div class="upload-icon">ğŸ“„</div>
                        <p class="upload-text">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p>
                        <p class="upload-hint">æ”¯æŒ .log .txt æ ¼å¼çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼Œæœ€å¤§50MB</p>
                        <input type="file" id="file-input" accept=".log,.txt" style="display: none;">
                        <button class="upload-btn" onclick="document.getElementById('file-input').click()">é€‰æ‹©æ–‡ä»¶</button>
                    </div>
                </div>
                <div class="file-info" id="file-info" style="display: none;">
                    <span class="file-name" id="file-name"></span>
                    <button class="clear-btn" onclick="clearFile()">âœ•</button>
                </div>
            </div>
        </div>

        <div id="stats-section" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-hooks">0</div>
                    <div class="stat-label">æ€»äº‹ä»¶æ•°</div>
                    <div class="stat-description">æ‰€æœ‰ Hooks äº‹ä»¶</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="user-prompts">0</div>
                    <div class="stat-label">ç”¨æˆ·æç¤ºäº‹ä»¶</div>
                    <div class="stat-description">UserPromptSubmit</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pre-tools">0</div>
                    <div class="stat-label">å·¥å…·æ‰§è¡Œå‰äº‹ä»¶</div>
                    <div class="stat-description">PreToolUse</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="post-tools">0</div>
                    <div class="stat-label">å·¥å…·æ‰§è¡Œåäº‹ä»¶</div>
                    <div class="stat-description">PostToolUse</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="notifications">0</div>
                    <div class="stat-label">é€šçŸ¥äº‹ä»¶</div>
                    <div class="stat-description">Notification</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stops">0</div>
                    <div class="stat-label">åœæ­¢äº‹ä»¶</div>
                    <div class="stat-description">Stop</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="subagent-stops">0</div>
                    <div class="stat-label">å­ä»£ç†åœæ­¢äº‹ä»¶</div>
                    <div class="stat-description">SubagentStop</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pre-compacts">0</div>
                    <div class="stat-label">å‹ç¼©å‰äº‹ä»¶</div>
                    <div class="stat-description">PreCompact</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="session-starts">0</div>
                    <div class="stat-label">ä¼šè¯å¼€å§‹äº‹ä»¶</div>
                    <div class="stat-description">SessionStart</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="session-ends">0</div>
                    <div class="stat-label">ä¼šè¯ç»“æŸäº‹ä»¶</div>
                    <div class="stat-description">SessionEnd</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="transcript-count">0</div>
                    <div class="stat-label">åŒ…å«è½¬å½•è·¯å¾„äº‹ä»¶</div>
                    <div class="stat-description">åŒ…å« transcript_path</div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-controls">
                    <div class="filter-group">
                        <label class="filter-label">äº‹ä»¶ç±»å‹ï¼š</label>
                        <select class="filter-select" id="event-filter">
                            <option value="">å…¨éƒ¨</option>
                            <option value="UserPromptSubmit">UserPromptSubmit</option>
                            <option value="PreToolUse">PreToolUse</option>
                            <option value="PostToolUse">PostToolUse</option>
                            <option value="Notification">Notification</option>
                            <option value="Stop">Stop</option>
                            <option value="SubagentStop">SubagentStop</option>
                            <option value="PreCompact">PreCompact</option>
                            <option value="SessionStart">SessionStart</option>
                            <option value="SessionEnd">SessionEnd</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">æœç´¢ï¼š</label>
                        <input type="text" class="search-input" id="search-input" placeholder="æœç´¢äº‹ä»¶å†…å®¹...">
                    </div>
                </div>
            </div>
        </div>

        <div id="hooks-container" class="hooks-container"></div>

        <div id="no-data" class="no-data">
            è¯·ä¸Šä¼  hooks.log æ–‡ä»¶å¼€å§‹åˆ†æ
        </div>

        <div id="error-message" class="error-message" style="display: none;"></div>
    </div>

    <script>
        let hooksData = [];
        let filteredData = [];

        // æ–‡ä»¶ä¸Šä¼ ç›¸å…³å‡½æ•°
        function setupFileUpload() {
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');

            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©ï¼ˆä½†ä¸åŒ…æ‹¬æŒ‰é’®ï¼‰
            uploadArea.addEventListener('click', function(event) {
                // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼Œä¸å¤„ç†
                if (event.target.tagName === 'BUTTON' || event.target.closest('button')) {
                    return;
                }
                fileInput.click();
            });

            // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            fileInput.addEventListener('change', handleFileSelect);

            // æ‹–æ‹½äº‹ä»¶
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
        }


        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            if (files.length === 0) return;

            const file = files[0];

            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            const validTypes = ['.log', '.txt'];
            const fileExtension = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();

            if (!validTypes.includes(fileExtension)) {
                showErrorMessage('è¯·é€‰æ‹© .log æˆ– .txt æ ¼å¼çš„æ—¥å¿—æ–‡ä»¶');
                return;
            }

            // æ£€æŸ¥æ–‡ä»¶å¤§å° (é™åˆ¶ä¸º50MB)
            if (file.size > 50 * 1024 * 1024) {
                showErrorMessage('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡50MB');
                return;
            }

            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            showFileInfo(file);

            // è¯»å–æ–‡ä»¶å†…å®¹
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    console.log('æ–‡ä»¶è¯»å–æˆåŠŸï¼Œå†…å®¹é•¿åº¦:', content.length);
                    console.log('æ–‡ä»¶å†…å®¹å‰100å­—ç¬¦:', content.substring(0, 100));

                    if (!content || content.trim().length === 0) {
                        showErrorMessage('æ–‡ä»¶å†…å®¹ä¸ºç©º');
                        return;
                    }

                    parseHooksData(content);
                    showSuccessMessage(`æˆåŠŸåŠ è½½æ–‡ä»¶: ${file.name}`);
                } catch (error) {
                    console.error('æ–‡ä»¶è§£æå¼‚å¸¸:', error);
                    showErrorMessage('æ–‡ä»¶è§£æå¤±è´¥ï¼š' + error.message);
                }
            };
            reader.onerror = function(error) {
                console.error('æ–‡ä»¶è¯»å–å¤±è´¥:', error);
                showErrorMessage('æ–‡ä»¶è¯»å–å¤±è´¥');
            };
            reader.readAsText(file);
        }

        function showFileInfo(file) {
            const fileInfo = document.getElementById('file-info');
            const fileName = document.getElementById('file-name');
            const uploadArea = document.getElementById('upload-area');

            fileName.textContent = file.name;
            fileInfo.style.display = 'flex';
            uploadArea.style.display = 'none';
        }

        function clearFile() {
            const fileInfo = document.getElementById('file-info');
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');

            fileInfo.style.display = 'none';
            uploadArea.style.display = 'block';

            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥æ¡†çš„å€¼
            fileInput.value = '';

            // æ¸…ç©ºæ•°æ®
            hooksData = [];
            filteredData = [];

            // æ¸…ç©ºæ˜¾ç¤ºåŒºåŸŸ
            document.getElementById('hooks-container').innerHTML = '';
            document.getElementById('no-data').style.display = 'block';
            document.getElementById('stats-section').style.display = 'none';

            // æ˜¾ç¤ºæç¤º
            showSuccessMessage('å·²æ¸…ç©ºæ–‡ä»¶ï¼Œè¯·é‡æ–°é€‰æ‹©æ—¥å¿—æ–‡ä»¶');
        }

        function showSuccessMessage(message) {
            showMessage(message, 'success');
        }

        function showErrorMessage(message) {
            showMessage(message, 'error');
        }

        function showMessage(message, type) {
            // ç§»é™¤ä¹‹å‰çš„æ¶ˆæ¯
            const existingMessages = document.querySelectorAll('.upload-message');
            existingMessages.forEach(msg => msg.remove());

            const messageClass = type === 'success' ? 'upload-success' : 'upload-error';
            const messageDiv = document.createElement('div');
            messageDiv.className = `upload-message ${messageClass}`;
            messageDiv.textContent = message;

            document.querySelector('.upload-card').appendChild(messageDiv);

            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                messageDiv.style.opacity = '0';
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 300);
            }, 3000);
        }

        // è§£æ hooks æ•°æ®
        function parseHooksData(content) {
            console.log('å¼€å§‹è§£æ hooks æ•°æ®ï¼Œå†…å®¹é•¿åº¦:', content.length);

            hooksData = [];
            const lines = content.split('\n').filter(line => line.trim());
            console.log('åˆ†å‰²åçš„è¡Œæ•°:', lines.length);

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                try {
                    const hookData = JSON.parse(line);
                    hooksData.push(hookData);
                    console.log(`æˆåŠŸè§£æç¬¬ ${i + 1} è¡Œï¼Œäº‹ä»¶ç±»å‹:`, hookData.event);
                } catch (error) {
                    console.error(`è§£æç¬¬ ${i + 1} è¡Œå¤±è´¥:`, error.message);
                    console.error('é—®é¢˜è¡Œçš„å†…å®¹:', line.substring(0, 100) + (line.length > 100 ? '...' : ''));
                }
            }

            console.log('è§£æå®Œæˆï¼Œæ€»å…±è§£æåˆ°', hooksData.length, 'ä¸ªæœ‰æ•ˆäº‹ä»¶');

            if (hooksData.length === 0) {
                showErrorMessage('æœªæ‰¾åˆ°æœ‰æ•ˆçš„ hooks æ•°æ®ã€‚è¯·ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼Œæ¯è¡Œåº”è¯¥æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„JSONå¯¹è±¡ã€‚');
                console.error('è§£æå¤±è´¥ï¼Œæ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„hooksæ•°æ®');
                return;
            }

            filteredData = [...hooksData];
            console.log('å‡†å¤‡æ˜¾ç¤ºæ•°æ®ï¼Œè¿‡æ»¤åçš„äº‹ä»¶æ•°é‡:', filteredData.length);
            displayData();
        }

        // æ˜¾ç¤ºæ•°æ®
        function displayData() {
            document.getElementById('no-data').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('stats-section').style.display = 'block';

            updateStatistics();
            renderHooks();
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStatistics() {
            const stats = {
                total: filteredData.length,
                userPrompts: filteredData.filter(h => h.event === 'UserPromptSubmit').length,
                preTools: filteredData.filter(h => h.event === 'PreToolUse').length,
                postTools: filteredData.filter(h => h.event === 'PostToolUse').length,
                notifications: filteredData.filter(h => h.event === 'Notification').length,
                stops: filteredData.filter(h => h.event === 'Stop').length,
                subagentStops: filteredData.filter(h => h.event === 'SubagentStop').length,
                preCompacts: filteredData.filter(h => h.event === 'PreCompact').length,
                sessionStarts: filteredData.filter(h => h.event === 'SessionStart').length,
                sessionEnds: filteredData.filter(h => h.event === 'SessionEnd').length,
                transcriptCount: filteredData.filter(h => hasTranscriptPath(h)).length
            };

            document.getElementById('total-hooks').textContent = stats.total;
            document.getElementById('user-prompts').textContent = stats.userPrompts;
            document.getElementById('pre-tools').textContent = stats.preTools;
            document.getElementById('post-tools').textContent = stats.postTools;
            document.getElementById('notifications').textContent = stats.notifications;
            document.getElementById('stops').textContent = stats.stops;
            document.getElementById('subagent-stops').textContent = stats.subagentStops;
            document.getElementById('pre-compacts').textContent = stats.preCompacts;
            document.getElementById('session-starts').textContent = stats.sessionStarts;
            document.getElementById('session-ends').textContent = stats.sessionEnds;
            document.getElementById('transcript-count').textContent = stats.transcriptCount;
        }

        // æ¸²æŸ“ hooks
        function renderHooks() {
            const container = document.getElementById('hooks-container');
            container.innerHTML = '';

            filteredData.forEach((hook, index) => {
                const hookElement = createHookElement(hook, index);
                container.appendChild(hookElement);
            });

            // æ·»åŠ åŠ¨ç”»
            const elements = container.querySelectorAll('.hook-item');
            elements.forEach((el, i) => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    el.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, i * 50);
            });
        }

        // æ£€æŸ¥æ˜¯å¦åŒ…å« transcript_path å­—æ®µ
        function hasTranscriptPath(hook) {
            if (!hook.payload) return false;

            // æ£€æŸ¥ payload ä¸­æ˜¯å¦ç›´æ¥åŒ…å« transcript_path
            if (hook.payload.transcript_path) return true;

            // æ·±åº¦æœç´¢ payload å¯¹è±¡ä¸­çš„ transcript_path å­—æ®µ
            return searchInObject(hook.payload, 'transcript_path');
        }

        // åœ¨å¯¹è±¡ä¸­é€’å½’æœç´¢æŒ‡å®šå­—æ®µ
        function searchInObject(obj, fieldName) {
            if (!obj || typeof obj !== 'object') return false;

            for (const key in obj) {
                if (key === fieldName) return true;

                if (typeof obj[key] === 'object' && obj[key] !== null) {
                    if (searchInObject(obj[key], fieldName)) return true;
                }
            }

            return false;
        }

        // è·å– transcript_path çš„å€¼
        function getTranscriptPath(hook) {
            if (!hook.payload) return null;

            // æ£€æŸ¥ payload ä¸­æ˜¯å¦ç›´æ¥åŒ…å« transcript_path
            if (hook.payload.transcript_path) return hook.payload.transcript_path;

            // æ·±åº¦æœç´¢å¹¶è¿”å› transcript_path çš„å€¼
            return findValueInObject(hook.payload, 'transcript_path');
        }

        // åœ¨å¯¹è±¡ä¸­é€’å½’æŸ¥æ‰¾æŒ‡å®šå­—æ®µçš„å€¼
        function findValueInObject(obj, fieldName) {
            if (!obj || typeof obj !== 'object') return null;

            for (const key in obj) {
                if (key === fieldName) return obj[key];

                if (typeof obj[key] === 'object' && obj[key] !== null) {
                    const found = findValueInObject(obj[key], fieldName);
                    if (found !== null) return found;
                }
            }

            return null;
        }

        // åˆ›å»º hook å…ƒç´ 
        function createHookElement(hook, index) {
            const div = document.createElement('div');
            div.className = 'hook-item';

            const eventClass = getEventClass(hook.event);
            const formattedTime = formatTimestamp(hook.ts);
            const eventDescription = getEventDescription(hook.event, hook.phase);
            const hasTranscript = hasTranscriptPath(hook);
            const transcriptPath = getTranscriptPath(hook);

            div.innerHTML = `
                <div class="hook-header">
                    <div class="hook-event">
                        <span class="event-badge ${eventClass}">${hook.event}</span>
                        ${hasTranscript ? '<span class="has-transcript-badge">åŒ…å«è½¬å½•è·¯å¾„</span>' : ''}
                    </div>
                    <div class="hook-meta">
                        <div class="hook-timestamp">${formattedTime}</div>
                    </div>
                </div>
                <div class="hook-message">${hook.message}</div>
                <div class="hook-description">${hook.description || eventDescription}</div>
                ${hasTranscript && transcriptPath ? `
                <div class="transcript-path">
                    <div class="transcript-path-label">ğŸ“„ è½¬å½•è·¯å¾„ (transcript_path):</div>
                    <div class="transcript-path-value">${escapeHtml(transcriptPath)}</div>
                    <div class="transcript-actions">
                        <button class="transcript-btn copy" onclick="copyTranscriptPath('${transcriptPath.replace(/\\/g, '\\\\').replace(/'/g, "\\'")}')" title="å¤åˆ¶è·¯å¾„">
                            ğŸ“‹ å¤åˆ¶
                        </button>
                        ${isUrl(transcriptPath) ?
                            `<button class="transcript-btn open" onclick="openTranscriptUrl('${transcriptPath.replace(/\\/g, '\\\\').replace(/'/g, "\\'")}')" title="åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€">
                                ğŸ”— æ‰“å¼€é“¾æ¥
                            </button>` :
                            `<button class="transcript-btn open" onclick="tryOpenTranscriptFile('${transcriptPath.replace(/\\/g, '\\\\').replace(/'/g, "\\'")}')" title="å°è¯•æ‰“å¼€æ–‡ä»¶">
                                ğŸ“‚ å°è¯•æ‰“å¼€
                            </button>`
                        }
                    </div>
                </div>
                ` : ''}
                <div class="hook-details">
                    <div class="part-card">
                        <div class="part-header" onclick="toggleDetail('payload-${index}')">
                            <span>Payload</span>
                            <span class="toggle-icon" id="icon-payload-${index}">â–¼</span>
                        </div>
                        <div class="part-content hidden" id="payload-${index}">
                            ${formatJson(hook.payload)}
                        </div>
                    </div>
                </div>
            `;

            return div;
        }

        // è·å–äº‹ä»¶æè¿°
        function getEventDescription(event, phase) {
            switch (event) {
                case 'PreToolUse':
                    return 'å·¥å…·æ‰§è¡Œå‰è§¦å‘ï¼Œå¯åŸºäºå‚æ•°é˜»æ­¢æˆ–è°ƒæ•´è°ƒç”¨ã€‚';
                case 'PostToolUse':
                    return 'å·¥å…·æˆåŠŸæ‰§è¡Œåè§¦å‘ï¼Œå¸¸ç”¨äºæ ¼å¼åŒ–ã€æ ¡éªŒæˆ–è®°å½•ç»“æœã€‚';
                case 'UserPromptSubmit':
                    return 'ç”¨æˆ·æäº¤æç¤ºå‰è§¦å‘ï¼Œå¯è¿›è¡Œæç¤ºæ ¡éªŒæˆ–å¢å¼ºã€‚';
                case 'Notification':
                    return 'å½“ç³»ç»Ÿå‘é€é€šçŸ¥ï¼ˆéœ€æˆæƒæˆ–ç­‰å¾…è¾“å…¥ï¼‰æ—¶è§¦å‘ã€‚';
                case 'Stop':
                    return 'ä¸»ä»£ç†å®Œæˆå“åº”æ—¶è§¦å‘ï¼ˆç”¨æˆ·ä¸­æ–­ä¸è§¦å‘ï¼‰ã€‚';
                case 'SubagentStop':
                    return 'å­ä»£ç†ä»»åŠ¡å®Œæˆæ—¶è§¦å‘ï¼Œç”¨äºè®°å½•å­ä»»åŠ¡ç»“æŸã€‚';
                case 'PreCompact':
                    return phase === 'manual'
                        ? 'æ‰‹åŠ¨å‹ç¼©å‰è§¦å‘ï¼Œç”¨äºè®°å½•æˆ–å‡†å¤‡å‹ç¼©ã€‚'
                        : 'è‡ªåŠ¨å‹ç¼©å‰è§¦å‘ï¼ˆä¸Šä¸‹æ–‡æ¥è¿‘ä¸Šé™ï¼‰ï¼Œç”¨äºè®°å½•æˆ–å‡†å¤‡å‹ç¼©ã€‚';
                case 'SessionStart':
                    switch (phase) {
                        case 'startup':
                            return 'æ–°ä¼šè¯å¯åŠ¨æ—¶è§¦å‘ï¼Œç”¨äºåŠ è½½ä¸Šä¸‹æ–‡æˆ–è®¾ç½®ç¯å¢ƒã€‚';
                        case 'resume':
                            return 'æ¢å¤ä¼šè¯æ—¶è§¦å‘ï¼Œç”¨äºç»§ç»­å…ˆå‰ä¸Šä¸‹æ–‡ã€‚';
                        case 'clear':
                            return 'æ¸…ç©ºä¼šè¯åè§¦å‘ï¼Œç”¨äºé‡ç½®ç¯å¢ƒä¸ä¸Šä¸‹æ–‡ã€‚';
                        case 'compact':
                            return 'å› å‹ç¼©æ“ä½œè§¦å‘çš„ä¼šè¯å¯åŠ¨ï¼Œç”¨äºç»´æŒä¸Šä¸‹æ–‡ã€‚';
                        default:
                            return 'ä¼šè¯å¯åŠ¨ç›¸å…³äº‹ä»¶ï¼Œåˆå§‹åŒ–æˆ–æ¢å¤ä¸Šä¸‹æ–‡ã€‚';
                    }
                case 'SessionEnd':
                    return 'ä¼šè¯ç»“æŸæ—¶è§¦å‘ï¼Œå¸¸ç”¨äºæ”¶å°¾ä¸æ¸…ç†ã€‚';
                default:
                    return 'æœªçŸ¥äº‹ä»¶ã€‚';
            }
        }

        // è·å–äº‹ä»¶æ ·å¼ç±»
        function getEventClass(event) {
            switch (event) {
                case 'UserPromptSubmit': return 'event-userprompt';
                case 'PreToolUse': return 'event-pretool';
                case 'PostToolUse': return 'event-posttool';
                case 'Notification': return 'event-notification';
                case 'Stop': return 'event-stop';
                case 'SubagentStop': return 'event-subagent-stop';
                case 'PreCompact': return 'event-pre-compact';
                case 'SessionStart': return 'event-session-start';
                case 'SessionEnd': return 'event-session-end';
                default: return 'event-default';
            }
        }

        // æ ¼å¼åŒ–æ—¶é—´æˆ³
        function formatTimestamp(ts) {
            const date = new Date(ts);
            return date.toLocaleString('zh-CN');
        }

        // æ ¼å¼åŒ– JSON
        function formatJson(obj, indent = 0) {
            if (!obj) return '';

            try {
                const spaces = '  '.repeat(indent);
                let result = '';

                if (Array.isArray(obj)) {
                    result += '[\n';
                    obj.forEach((item, index) => {
                        result += spaces + '  ';
                        if (typeof item === 'object' && item !== null) {
                            result += formatJson(item, indent + 1);
                        } else {
                            result += formatJsonValue(item);
                        }
                        if (index < obj.length - 1) result += ',';
                        result += '\n';
                    });
                    result += spaces + ']';
                } else if (typeof obj === 'object' && obj !== null) {
                    result += '{\n';
                    const keys = Object.keys(obj);
                    keys.forEach((key, index) => {
                        result += spaces + '  ';
                        result += `<span class="json-key">"${escapeHtml(key)}"</span>: `;

                        if (typeof obj[key] === 'object' && obj[key] !== null) {
                            result += formatJson(obj[key], indent + 1);
                        } else {
                            result += formatJsonValue(obj[key]);
                        }

                        if (index < keys.length - 1) result += ',';
                        result += '\n';
                    });
                    result += spaces + '}';
                } else {
                    result += formatJsonValue(obj);
                }

                return result;
            } catch (error) {
                return escapeHtml(JSON.stringify(obj));
            }
        }

        // æ ¼å¼åŒ– JSON å€¼
        function formatJsonValue(value) {
            if (typeof value === 'string') {
                if (value.startsWith('http://') || value.startsWith('https://')) {
                    return `<span class="json-url" onclick="window.open('${escapeHtml(value)}', '_blank')">"${escapeHtml(value)}"</span>`;
                }
                return `<span class="json-string">"${escapeHtml(value)}"</span>`;
            } else if (typeof value === 'number') {
                return `<span class="json-number">${value}</span>`;
            } else if (typeof value === 'boolean') {
                return `<span class="json-boolean">${value}</span>`;
            } else if (value === null) {
                return `<span class="json-null">null</span>`;
            } else {
                return `<span style="color: #666;">${value}</span>`;
            }
        }

        // HTML è½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // åˆ‡æ¢è¯¦æƒ…æ˜¾ç¤º
        function toggleDetail(id) {
            const content = document.getElementById(id);
            const icon = document.getElementById('icon-' + id);

            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('rotated');
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotated');
            }
        }

        // è¿‡æ»¤å’Œæœç´¢
        document.getElementById('event-filter').addEventListener('change', applyFilters);
        document.getElementById('search-input').addEventListener('input', applyFilters);

        function applyFilters() {
            const eventFilter = document.getElementById('event-filter').value;
            const searchText = document.getElementById('search-input').value.toLowerCase();

            filteredData = hooksData.filter(hook => {
                const matchEvent = !eventFilter || hook.event === eventFilter;
                const matchSearch = !searchText ||
                    JSON.stringify(hook).toLowerCase().includes(searchText);

                return matchEvent && matchSearch;
            });

            updateStatistics();
            renderHooks();
        }

        // æ£€æŸ¥æ˜¯å¦ä¸º URL
        function isUrl(text) {
            try {
                new URL(text);
                return true;
            } catch {
                return false;
            }
        }

        // å¤åˆ¶è½¬å½•è·¯å¾„åˆ°å‰ªè´´æ¿
        async function copyTranscriptPath(path) {
            try {
                await navigator.clipboard.writeText(path);
                showToast('è·¯å¾„å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            } catch (error) {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = path;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('è·¯å¾„å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }
        }

        // æ‰“å¼€è½¬å½•é“¾æ¥ï¼ˆURLï¼‰
        function openTranscriptUrl(url) {
            window.open(url, '_blank');
        }

        // å°è¯•æ‰“å¼€æœ¬åœ°æ–‡ä»¶ï¼ˆé€šè¿‡æ–‡ä»¶é€‰æ‹©å™¨ï¼‰
        function tryOpenTranscriptFile(path) {
            // æ–¹æ¡ˆ1ï¼šå¤åˆ¶è·¯å¾„åˆ°å‰ªè´´æ¿
            copyTranscriptPath(path);

            // æ–¹æ¡ˆ2ï¼šå¦‚æœæ˜¯ç½‘ç»œé“¾æ¥ï¼Œç›´æ¥æ‰“å¼€
            if (path.startsWith('http://') || path.startsWith('https://')) {
                openTranscriptUrl(path);
                return;
            }

            // æ–¹æ¡ˆ3ï¼šä½¿ç”¨æ–‡ä»¶é€‰æ‹©å™¨è®©ç”¨æˆ·é€‰æ‹©æœ¬åœ°æ–‡ä»¶
            if (path.startsWith('file://')) {
                // file:// åè®®ï¼Œæå–æ–‡ä»¶è·¯å¾„
                const cleanPath = path.replace(/^file:\/\//, '');
                showFileSelector(cleanPath);
            } else {
                // æœ¬åœ°æ–‡ä»¶è·¯å¾„
                showFileSelector(path);
            }
        }

        // æ˜¾ç¤ºæ–‡ä»¶é€‰æ‹©å™¨
        function showFileSelector(expectedPath) {
            const input = document.createElement('input');
            input.type = 'file';
            input.style.display = 'none';

            // ä»è·¯å¾„ä¸­æå–æ–‡ä»¶å
            const fileName = expectedPath.split(/[/\\]/).pop();

            input.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    if (file.name === fileName) {
                        // æ–‡ä»¶ååŒ¹é…ï¼Œè¯»å–å¹¶æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
                        readAndDisplayFile(file);
                    } else {
                        showToast(`é€‰æ‹©çš„æ–‡ä»¶åä¸åŒ¹é…\næœŸæœ›: ${fileName}\nå®é™…: ${file.name}`, 'warning');
                        // ä»ç„¶æ˜¾ç¤ºé€‰æ‹©çš„æ–‡ä»¶å†…å®¹
                        readAndDisplayFile(file);
                    }
                }
                // æ¸…ç†inputå…ƒç´ 
                document.body.removeChild(input);
            });

            document.body.appendChild(input);

            // æ˜¾ç¤ºæç¤ºï¼Œç„¶åè§¦å‘æ–‡ä»¶é€‰æ‹©
            showToast(`è¯·é€‰æ‹©æ–‡ä»¶: ${fileName}`, 'info');
            setTimeout(() => {
                input.click();
            }, 500);
        }

        // è¯»å–å¹¶æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
        function readAndDisplayFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;

                // åˆ›å»ºä¸€ä¸ªæ¨¡æ€çª—å£æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
                showFileModal(file.name, content);
            };

            reader.onerror = function() {
                showToast('æ–‡ä»¶è¯»å–å¤±è´¥', 'error');
            };

            reader.readAsText(file);
        }

        // æ˜¾ç¤ºæ–‡ä»¶å†…å®¹çš„æ¨¡æ€çª—å£
        function showFileModal(fileName, content) {
            // åˆ›å»ºæ¨¡æ€èƒŒæ™¯
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
                animation: fadeIn 0.3s ease;
            `;

            // åˆ›å»ºæ¨¡æ€å†…å®¹
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                border-radius: 12px;
                width: 90%;
                max-width: 800px;
                max-height: 80vh;
                display: flex;
                flex-direction: column;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                animation: slideUp 0.3s ease;
            `;

            // åˆ›å»ºå¤´éƒ¨
            const header = document.createElement('div');
            header.style.cssText = `
                padding: 20px;
                border-bottom: 1px solid #e0e0e0;
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: #f8f9fa;
                border-radius: 12px 12px 0 0;
            `;

            const title = document.createElement('h3');
            title.textContent = `ğŸ“„ ${fileName}`;
            title.style.cssText = `
                margin: 0;
                color: #333;
                font-size: 1.2rem;
            `;

            // åˆ›å»ºæ“ä½œæŒ‰é’®åŒºåŸŸ
            const actions = document.createElement('div');
            actions.style.cssText = `
                display: flex;
                gap: 10px;
                align-items: center;
            `;

            const copyBtn = document.createElement('button');
            copyBtn.textContent = 'ğŸ“‹ å¤åˆ¶å†…å®¹';
            copyBtn.style.cssText = `
                background: #28a745;
                color: white;
                border: none;
                padding: 6px 12px;
                border-radius: 4px;
                font-size: 0.8rem;
                cursor: pointer;
                transition: background 0.3s ease;
            `;
            copyBtn.onmouseover = () => copyBtn.style.background = '#218838';
            copyBtn.onmouseout = () => copyBtn.style.background = '#28a745';

            const closeBtn = document.createElement('button');
            closeBtn.textContent = 'âœ•';
            closeBtn.style.cssText = `
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
                color: #666;
                padding: 5px;
                border-radius: 50%;
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            closeBtn.onmouseover = () => closeBtn.style.background = '#e0e0e0';
            closeBtn.onmouseout = () => closeBtn.style.background = 'none';

            // æ·»åŠ å¤åˆ¶åŠŸèƒ½
            copyBtn.onclick = async () => {
                try {
                    await navigator.clipboard.writeText(content);
                    showToast('æ–‡ä»¶å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                } catch (error) {
                    // é™çº§æ–¹æ¡ˆ
                    const textArea = document.createElement('textarea');
                    textArea.value = content;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showToast('æ–‡ä»¶å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }
            };

            // åˆ›å»ºå†…å®¹åŒºåŸŸ
            const contentArea = document.createElement('div');
            contentArea.style.cssText = `
                padding: 20px;
                overflow-y: auto;
                flex: 1;
                font-family: 'Courier New', monospace;
                font-size: 0.9rem;
                line-height: 1.5;
                background: #1a1a1a;
                color: #ffffff;
                white-space: pre-wrap;
                border-radius: 0 0 12px 12px;
                max-height: 60vh;
            `;

            // è®¾ç½®å†…å®¹
            contentArea.textContent = content;

            // ç»„è£…æ¨¡æ€çª—å£
            actions.appendChild(copyBtn);
            actions.appendChild(closeBtn);
            header.appendChild(title);
            header.appendChild(actions);
            modalContent.appendChild(header);
            modalContent.appendChild(contentArea);
            modal.appendChild(modalContent);

            // æ·»åŠ å…³é—­äº‹ä»¶
            closeBtn.onclick = () => document.body.removeChild(modal);
            modal.onclick = (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };

            // æ·»åŠ é”®ç›˜æ”¯æŒ (ESC å…³é—­)
            const keyHandler = (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(modal);
                    document.removeEventListener('keydown', keyHandler);
                }
            };
            document.addEventListener('keydown', keyHandler);

            // æ¨¡æ€çª—å£å…³é—­æ—¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
            const cleanup = () => {
                document.removeEventListener('keydown', keyHandler);
                if (document.body.contains(modal)) {
                    document.body.removeChild(modal);
                }
            };
            closeBtn.onclick = cleanup;
            modal.onclick = (e) => {
                if (e.target === modal) {
                    cleanup();
                }
            };

            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(modal);

            // æ·»åŠ åŠ¨ç”»æ ·å¼
            if (!document.getElementById('modal-animations')) {
                const style = document.createElement('style');
                style.id = 'modal-animations';
                style.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes slideUp {
                        from {
                            opacity: 0;
                            transform: translateY(50px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : type === 'error' ? '#dc3545' : '#007bff'};
                color: white;
                padding: 12px 16px;
                border-radius: 6px;
                font-size: 0.9rem;
                z-index: 10000;
                max-width: 400px;
                word-wrap: break-word;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideInRight 0.3s ease;
            `;

            toast.textContent = message;
            document.body.appendChild(toast);

            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // æ·»åŠ åˆå§‹åŠ è½½åŠ¨ç”»
            const cards = document.querySelectorAll('.stat-card, .upload-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });

            // è®¾ç½®æ–‡ä»¶ä¸Šä¼ 
            setupFileUpload();
        });

            </script>
</body>
</html>